{% extends "base.html" %}

{% block title %}High Throughput Screening{% endblock %}
{% block bodytitle %}Welcome to Thunor{% endblock %}

{% block content %}
<div class="container">
    <div class="jumbotron navy">
        <p>Please create a dataset to get started.</p>
        <p><a role="button" class="btn btn-primary" href="{% url 'pyhts:plate_upload' %}">Create Dataset</a></p>
    </div>
</div>
<div class="row">
<div class="col-lg-12">
    <ul id="dataset-tabs" class="nav nav-tabs" role="tablist" style="margin-bottom:-1px">
        <li role="presentation" data-url="{% url 'pyhts:ajax_get_datasets' %}" class="active"><a href="#">My Datasets</a></li>
        {% for group in request.user.groups.all %}
            <li role="presentation" data-url="{% url 'pyhts:ajax_get_datasets_by_group' group.id %}">
                <a href="#">{{ group }}</a></li>
        {% endfor %}
    </ul>
    <div class="tab-content panel" style="border: 1px solid #ddd;
    padding:10px">
        <div role="tabpanel">
            <table id="dataset-table" class="table table-striped table-bordered"
                   width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Date Uploaded</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</div>
</div>
{% endblock %}

{% block tailscript %}
<script>
$(function() {
    var dataset_table = $('#dataset-table').DataTable( {
        "ajax": '{% url 'pyhts:ajax_get_datasets' %}',
        "columnDefs": [
            {"targets": 0, "data": "name", "render": {
                "display": function( data, type, full, meta ) {
                    return '<a href="/dataset/'+full.id+'">'+full.name+'</a>';
                }
            }},
            {"targets": 1, "data": "creation_date"}
        ]
    } );

    var $datasetTabs = $('#dataset-tabs');

    $datasetTabs.find('li').click(function(e) {
        e.preventDefault();
        var $this = $(e.currentTarget);
        dataset_table.ajax.url($this.data('url')).load();
        $datasetTabs.find('li').removeClass('active');
        $this.addClass('active');
    });
} );
</script>
{% endblock %}
