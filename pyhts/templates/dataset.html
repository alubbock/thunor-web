{% extends "base.html" %}

{% block title %}{{ dataset.name }}{% endblock %}

{% block content %}
    <div class="row">
    <div class="col-md-9">
        {% if request.user.id == dataset.owner_id or 'view_plots' in perms %}
        <h4>Visualisation</h4>
        <p>
        <a href="{% url 'pyhts:plots' dataset.id %}" role="button"
           class="btn btn-default">Interactive plots</a>
        </p>
        {% endif %}

        {% if request.user.id == dataset.owner_id %}
        <h4>Data Modification</h4>
        {% elif 'view_plate_layout' in perms %}
        <h4>Layout Data</h4>
        {% endif %}
        <p>
        {% if request.user.id == dataset.owner.id %}
        <a href="{% url 'pyhts:plate_upload' dataset.id %}" role="button"
              class="btn btn-default">Attach more plate files</a>
        {% endif %}
        {% if request.user.id == dataset.owner_id or 'view_plate_layout' in perms %}
        <a href="{% url 'pyhts:plate_designer' dataset.id %}" role="button"
           class="btn btn-default">View{% if request.user_id == dataset.owner_id %}/edit{% endif %} plate design</a>
        {% endif %}
        </p>

        {% if request.user.id == dataset.owner.id or 'download_data' in perms %}
        <h4>Data Download</h4>
        <p>
        <a href="{% url 'pyhts:download_dataset_annotation' dataset.id %}"
           role="button" class="btn btn-default attachment-download">Download
            annotations (Excel)</a>
        <a href="{% url 'pyhts:download_dataset_assays' dataset.id %}"
           role="button" class="btn btn-default attachment-download">Download
            assays (Excel)</a>
        </p>
        {% endif %}
    </div>
    <div class="col-md-3">
        <p class="lead"><strong>Metadata</strong></p>
            <p><strong>Owner</strong><br><a href="mailto:{{ dataset.owner.email }}">{{ dataset.owner.email }}</a></p>
            <p><strong>Creation date</strong><br>{{ dataset.creation_date }}</p>
            <p><strong>Most recent plate file upload</strong><br>
                {{ dataset.last_upload }}</p>
            <p><strong>Most recent annotation</strong><br>
                {{ dataset.last_annotated }}</p>
            {% if dataset.control_handling %}
            <p><strong>Special control handling</strong><br>
                {{ dataset.get_control_handling_display }}</p>
            {% endif %}
        {% if request.user.id == dataset.owner.id %}
        <p class="lead"><strong>Permissions</strong></p>
            <a href="{% url 'pyhts:view_dataset_permissions' dataset.id %}"
            role="button" class="btn btn-default">View/Edit Dataset
                Permissions</a>
        <p class="lead"><strong>Destructive Operations</strong></p>
            <input type="hidden" id="dataset-id" name="dataset-id" value=
                    "{{ dataset.id }}">
            <button id="btn-delete-dataset" class="btn btn-danger">Delete
            Dataset</button>
        {% endif %}
    </div>
    </div>
{% endblock %}

{% block tailscript %}
<script>
$(function () {
    'use strict';
    pyHTS.views.dataset.activate();
});
</script>
{% endblock %}
