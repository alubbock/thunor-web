{% extends "base.html" %}

{% block title %}{% if public %}Public{% else %}Personal{% endif %} {{ entity_type }} Tags{% endblock %}

{% block content %}

  <div class="two-btn">
  <div class="square-btns">
{% if not public or request.user.is_superuser %}
<button class="btn btn-success btn-lg" style="width:170px" id="btn-add-tag"
        {% if not request.user.is_authenticated %}disabled{% endif %}>
  <i class="fa fa-3x fa-plus"></i><br>
  Add {% if public %}Public {% endif %}{{ entity_type }} Tag</button>
{% endif %}
{% if not public %}
  <a href="{% url 'thunorweb:tag_editor' tag_type %}" role="button"
     class="btn btn-primary btn-lg"><i class="fa fa-3x fa-users"></i><br>
    View Public<br>{{ entity_type }} tags</a>
{% elif request.user.is_authenticated %}
    <a href="{% url 'thunorweb:tag_editor_private' tag_type %}" role="button"
     class="btn btn-primary btn-lg"><i class="fa fa-3x fa-user"></i><br>
    View Personal<br>{{ entity_type }} tags</a>
{% endif %}
  <a role="button" href="{% url 'thunorweb:home' %}" class="btn
  btn-default btn-lg" style="width:170px"><i class="fa fa-3x
  fa-home"></i><br>Back to<br>Home Page</a>
    </div>
  </div>

<div class="tag-list">
{% for category, tag_entries in tags.items %}
  {% if category %}<h2>{{ category }}</h2>{% endif %}
  {% for tag_name, tag_tgts in tag_entries.items %}
    {% include "tag_editor_tag_template.html" %}{% endfor %}
{#{% empty %}#}
{#  {% if public %}There are currently no public {{ entity_type }} tags#}
{#  {% else %}You currently have no private {{ entity_type  }} tags{% endif %}#}
{% endfor %}
</div>

{% include "tag_editor_tag_template.html" %}

<div class="entity-select" style="display:none">
<select multiple data-live-search="true" name="entityId" autocomplete="off"
class="form-control" title="Select {{ entity_type }}s">
{% for ent in entities.values %}<option name="entityId" value="{{ ent.id }}">{{ ent.name }}</option>
{% endfor %}
</select>
<button type="submit" role="button" class="btn btn-block btn-primary"
        style="display:none">Save Tag</button>
<button type="button" role="button" class="btn btn-block btn-default btn-cancel-edit-tag">Cancel</button>
</div>
<span class="label label-primary" style="display:none" id="ent-name-tplt"></span>

{% endblock %}

{% block tailscript %}
<script>
$(function() {
    {% load jsonify from thunorweb_tags %}
    $.extend(pyHTS.state, {
        tags: {{ tags_ids|jsonify }},
        tagNames: {
    {% for eid, ent in entities.items %}{{eid}}:'{{ ent.name|escapejs }}'{% if not forloop.last %},{% endif %}{% endfor %}
        }
    });
    pyHTS.views.tag_editor.activate();
});
</script>
{% endblock %}
